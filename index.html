<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lector de Texto y PDF ‚Äî Gratis (Web Speech API + PDF.js)</title>
<style>
:root { --bg:#0f172a; --panel:#111827; --accent:#22d3ee; --text:#e5e7eb; --muted:#94a3b8; --ok:#34d399; --warn:#f59e0b; --err:#f87171; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,sans-serif}
header{padding:24px 16px;text-align:center;border-bottom:1px solid #1f2937}
header h1{margin:0;font-size:20px}
main{max-width:1000px;margin:0 auto;padding:16px;display:grid;gap:16px}
.card{background:var(--panel);border:1px solid #1f2937;border-radius:12px;padding:16px}
.row{display:grid;gap:12px}
.grid-2{grid-template-columns:1fr 1fr}
label{font-size:13px;color:var(--muted)}
textarea{width:100%;min-height:180px;resize:vertical;background:#0b1220;color:var(--text);border:1px solid #293244;border-radius:8px;padding:12px;line-height:1.5}
input[type="file"],input[type="url"],select,input[type="range"]{width:100%}
input[type="url"],select{background:#0b1220;color:var(--text);border:1px solid #293244;border-radius:8px;padding:10px}
.controls{display:flex;flex-wrap:wrap;gap:8px}
button{appearance:none;border:1px solid #1f2937;background:#0b1220;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
button.primary{background:linear-gradient(135deg,#0ea5e9,#22d3ee);color:#001018;border:none;font-weight:600}
button.ghost{background:transparent}
button:disabled{opacity:.5;cursor:not-allowed}
.kvs{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.kv{background:#0b1220;border:1px dashed #293244;border-radius:10px;padding:10px;font-size:13px;color:var(--muted)}
.meter{height:8px;border-radius:999px;background:#0b1220;border:1px solid #293244;overflow:hidden}
.meter > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22d3ee,#34d399)}
.small{font-size:12px;color:var(--muted)}
.ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
footer{padding:20px;text-align:center;color:var(--muted);font-size:12px}
.badge{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;background:#0b1220;border:1px solid #293244}
</style>
</head>
<body>
<header>
<h1>üó£Ô∏è Lector de Texto y PDF ‚Äî 100% Gratis, local en tu navegador</h1>
<div class="small">Funciona con <span class="badge">Web Speech API</span> + <span class="badge">PDF.js</span>. No sube tus archivos a ning√∫n servidor.</div>
</header>

<main>
<!-- Entrada -->
<section class="card">
<h2 style="margin-top:0">1) Carga tu contenido</h2>
<div class="row grid-2">
<div>
<label>Subir archivo (.pdf o .txt)</label>
<input id="fileInput" type="file" accept=".pdf,.txt" />
<div class="small">Los PDFs se procesan localmente con PDF.js. Los TXT se abren directo.</div>
</div>
<div>
<label>Pegar URL (opcional)</label>
<input id="urlInput" type="url" placeholder="https://ejemplo.com/articulo" />
<div class="controls">
<button id="fetchUrlBtn">Obtener y cargar texto</button>
</div>
<div class="small">Si el sitio bloquea CORS, el navegador no permitir√° traer el texto autom√°ticamente.</div>
</div>
</div>
<div style="margin-top:12px">
<label>O escribe/pega el texto directamente</label>
<textarea id="textInput" placeholder="Pega aqu√≠ el texto que quieres escuchar..."></textarea>
</div>
<div class="kvs" style="margin-top:12px">
<div class="kv"><b>Estado:</b> <span id="status">Listo</span></div>
<div class="kv"><b>Idioma sugerido:</b> <span id="langHint">es-ES</span></div>
<div class="kv"><b>Longitud (caracteres):</b> <span id="lenHint">0</span></div>
</div>
</section>

<!-- Voces y par√°metros -->
<section class="card">
<h2 style="margin-top:0">2) Voz y par√°metros</h2>
<div class="row grid-2">
<div>
<label>Voz disponible en tu navegador</label>
<select id="voiceSelect"></select>
<div class="small">Sugerencia: elige una voz <b>es-ES</b> o <b>es-LA</b> para espa√±ol natural.</div>
</div>
<div>
<label>Velocidad (rate)</label>
<input id="rate" type="range" min="0.5" max="2" step="0.1" value="1" />
<div class="meter"><i id="rateBar"></i></div>
</div>
</div>
<div class="row grid-2">
<div>
<label>Tono (pitch)</label>
<input id="pitch" type="range" min="0" max="2" step="0.1" value="1" />
<div class="meter"><i id="pitchBar"></i></div>
</div>
<div>
<label>Volumen</label>
<input id="volume" type="range" min="0" max="1" step="0.1" value="1" />
<div class="meter"><i id="volumeBar"></i></div>
</div>
</div>
</section>

<!-- Controles de lectura -->
<section class="card">
<h2 style="margin-top:0">3) Controles</h2>
<div class="controls">
<button id="speakBtn" class="primary">‚ñ∂Ô∏è Leer</button>
<button id="pauseBtn">‚è∏Ô∏è Pausar</button>
<button id="resumeBtn">‚ñ∂Ô∏è Reanudar</button>
<button id="stopBtn" class="ghost">‚èπÔ∏è Detener</button>
<button id="clearBtn" class="ghost">üßπ Limpiar</button>
</div>
<div class="small" style="margin-top:8px">
Pro tip: el texto se divide autom√°ticamente en ‚Äútrozos‚Äù para evitar cortes. Puedes pausar y reanudar cuando quieras.
</div>
</section>

<!-- Progreso -->
<section class="card">
<h2 style="margin-top:0">Progreso</h2>
<div class="meter"><i id="progressBar"></i></div>
<div class="small" style="margin-top:6px">
<span id="progressText">0%</span> ‚Äî <span id="chunkInfo">0 / 0</span> fragmentos
</div>
<div class="small" id="supportInfo" style="margin-top:8px"></div>
</section>
</main>

<footer>
Hecho para Ra√∫l ‚Äî uso libre. Requiere un navegador con soporte de <b>speechSynthesis</b>. PDF.js v√≠a CDN.
</footer>

<!-- PDF.js (para extraer texto de PDFs localmente en el navegador) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js" integrity="sha512-KiWzZfa7qv3Zj1mE2AQfCMyJOQ7NlXQK1yXQ2p6mQ2nKq35aSgQbY0ciV9ewVR5Xk+U9VujwQcZ1B1v+0s0y5A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
// ------------------ Utilidades ------------------
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const state = {
chunks: [], index: 0, speaking: false, voices: [], langPreferred: 'es-ES',
utterance: null, paused: false
};

const UI = {
status: $('#status'), lenHint: $('#lenHint'), langHint: $('#langHint'),
voiceSelect: $('#voiceSelect'),
rate: $('#rate'), pitch: $('#pitch'), volume: $('#volume'),
rateBar: $('#rateBar'), pitchBar: $('#pitchBar'), volumeBar: $('#volumeBar'),
progressBar: $('#progressBar'), progressText: $('#progressText'), chunkInfo: $('#chunkInfo'),
supportInfo: $('#supportInfo')
};

function setStatus(text, cls='') {
UI.status.textContent = text;
UI.status.className = cls;
}
function updateLen() {
UI.lenHint.textContent = ($('#textInput').value||'').length;
}
function updateMeters() {
UI.rateBar.style.width = ((UI.rate.value-0.5)/1.5*100)+'%';
UI.pitchBar.style.width = (UI.pitch.value/2*100)+'%';
UI.volumeBar.style.width = (UI.volume.value*100)+'%';
}
updateMeters();

// ------------------ Soporte Web Speech ------------------
function checkSupport() {
const hasSpeech = 'speechSynthesis' in window && 'SpeechSynthesisUtterance' in window;
UI.supportInfo.innerHTML = hasSpeech
? '‚úÖ Web Speech API disponible en este navegador.'
: '‚ùå Este navegador no soporta Web Speech API. Prueba con Chrome, Edge o Safari.';
}
checkSupport();

function loadVoices() {
state.voices = speechSynthesis.getVoices().sort((a,b)=>a.lang.localeCompare(b.lang));
UI.voiceSelect.innerHTML = '';
state.voices.forEach((v,i)=>{
const opt = document.createElement('option');
opt.value = i;
opt.textContent = `${v.name} ‚Äî ${v.lang}${v.default?' (default)':''}`;
UI.voiceSelect.appendChild(opt);
});
// Selecci√≥n sugerida (es-ES o similar)
const idx = state.voices.findIndex(v => /^es(-|_)/i.test(v.lang));
UI.voiceSelect.value = idx >= 0 ? idx : 0;
UI.langHint.textContent = idx>=0 ? state.voices[idx].lang : (state.voices[0]?.lang || '‚Äî');
}
loadVoices();
// Algunos navegadores cargan voces async:
if (typeof speechSynthesis !== 'undefined') {
speechSynthesis.onvoiceschanged = loadVoices;
}

// ------------------ Carga de archivos ------------------
$('#fileInput').addEventListener('change', async (e)=>{
const file = e.target.files?.[0];
if (!file) return;
const ext = file.name.toLowerCase().split('.').pop();
setStatus('Procesando archivo‚Ä¶');
try {
if (ext === 'txt') {
const text = await file.text();
$('#textInput').value = text;
updateLen();
setStatus('TXT cargado con √©xito ‚úÖ','ok');
} else if (ext === 'pdf') {
const buf = await file.arrayBuffer();
const text = await extractTextFromPDF(buf);
$('#textInput').value = text.trim();
updateLen();
setStatus('PDF extra√≠do con √©xito ‚úÖ','ok');
} else {
setStatus('Formato no soportado. Usa PDF o TXT.','warn');
}
} catch (err) {
console.error(err);
setStatus('Error al leer el archivo.','err');
}
});

async function extractTextFromPDF(arrayBuffer) {
const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
let out = '';
for (let p=1; p<=pdf.numPages; p++){
const page = await pdf.getPage(p);
const content = await page.getTextContent();
const strings = content.items.map(it=> ('str' in it) ? it.str : (it?.chars?.map(c=>c?.unicode||'').join('')||''));
out += strings.join(' ') + '\n\n';
}
return out;
}

// ------------------ URL fetch ------------------
$('#fetchUrlBtn').addEventListener('click', async ()=>{
const url = $('#urlInput').value.trim();
if (!url) { setStatus('Ingresa una URL.','warn'); return; }
setStatus('Descargando texto de la URL‚Ä¶');
try {
const res = await fetch(url, {mode:'cors'});
const html = await res.text();
// Extracci√≥n simple de texto visible (muy b√°sica, sin dependencias)
const tmp = document.createElement('div');
tmp.innerHTML = html;
// Eliminar scripts/estilos
tmp.querySelectorAll('script,style,noscript').forEach(n=>n.remove());
const text = tmp.innerText.replace(/\n{3,}/g, '\n\n').trim();
$('#textInput').value = text;
updateLen();
setStatus('Texto obtenido de la URL ‚úÖ','ok');
} catch (err) {
console.error(err);
setStatus('La web no permite CORS o la URL fall√≥. Pega el texto manualmente.','err');
}
});

// ------------------ Divisi√≥n en trozos ------------------
function chunkText(text, maxLen = 1800) {
// Web Speech puede cortar frases largas; dividimos inteligente por p√°rrafos y puntos.
const paras = text.split(/\n{2,}/);
const chunks = [];
let current = '';

function pushCurrent(){ if (current.trim()) { chunks.push(current.trim()); current=''; } }

paras.forEach(p=>{
if ((current + '\n\n' + p).length <= maxLen) {
current = current ? current + '\n\n' + p : p;
} else {
// Subdividir por frases
const sentences = p.split(/(?<=[\.\?\!‚Ä¶])\s+/);
sentences.forEach(s=>{
if ((current + ' ' + s).length <= maxLen) {
current = current ? current + ' ' + s : s;
} else {
pushCurrent();
if (s.length <= maxLen) {
current = s;
} else {
// Corte duro si una "frase" es enorme
for (let i=0; i<s.length; i+=maxLen) {
chunks.push(s.slice(i, i+maxLen));
}
current = '';
}
}
});
}
});
pushCurrent();
return chunks;
}

// ------------------ Lectura ------------------
function speakNext() {
if (state.index >= state.chunks.length) {
setStatus('Lectura finalizada ‚úÖ','ok');
state.speaking = false;
updateProgress();
return;
}
const utter = new SpeechSynthesisUtterance(state.chunks[state.index]);
state.utterance = utter;

// Voz y par√°metros
const v = state.voices[+UI.voiceSelect.value] || state.voices[0];
if (v) utter.voice = v;
utter.rate = +UI.rate.value;
utter.pitch = +UI.pitch.value;
utter.volume = +UI.volume.value;

// Eventos
utter.onstart = ()=> {
state.speaking = true;
setStatus(`Leyendo fragmento ${state.index+1} de ${state.chunks.length}‚Ä¶`);
updateProgress();
};
utter.onend = ()=> {
state.index++;
updateProgress();
// Continuar con el siguiente
speakNext();
};
utter.onerror = (e)=> {
console.error(e);
setStatus('Error durante la lectura.','err');
state.speaking = false;
};

speechSynthesis.speak(utter);
}

function updateProgress() {
const total = state.chunks.length || 1;
const pct = Math.round((state.index/total)*100);
UI.progressBar.style.width = pct + '%';
UI.progressText.textContent = pct + '%';
UI.chunkInfo.textContent = `${Math.min(state.index,total)} / ${total}`;
}

$('#speakBtn').addEventListener('click', ()=>{
const text = ($('#textInput').value || '').trim();
if (!text) { setStatus('No hay texto para leer.','warn'); return; }
if (!('speechSynthesis' in window)) { setStatus('Este navegador no soporta Web Speech.','err'); return; }

// Parar lo anterior si quedaba algo
speechSynthesis.cancel();
state.chunks = chunkText(text, 1800);
state.index = 0;
updateProgress();
setStatus('Iniciando lectura‚Ä¶');
speakNext();
});

$('#pauseBtn').addEventListener('click', ()=>{
if (speechSynthesis.speaking && !speechSynthesis.paused) {
speechSynthesis.pause();
state.paused = true;
setStatus('Pausado ‚è∏Ô∏è');
}
});

$('#resumeBtn').addEventListener('click', ()=>{
if (speechSynthesis.paused) {
speechSynthesis.resume();
state.paused = false;
setStatus('Reanudando ‚ñ∂Ô∏è');
}
});

$('#stopBtn').addEventListener('click', ()=>{
speechSynthesis.cancel();
state.speaking = false;
setStatus('Detenido ‚èπÔ∏è');
updateProgress();
});

$('#clearBtn').addEventListener('click', ()=>{
speechSynthesis.cancel();
$('#textInput').value = '';
updateLen();
state.chunks = []; state.index = 0;
updateProgress();
setStatus('Listo');
});

$('#textInput').addEventListener('input', updateLen);
</script>
</body>
</html>